%\part*{Additional topics}
\addtocontents{toc}{\protect\begin{center}}
\addtocontents{toc}{\large{\bf Additional topics}}
\addtocontents{toc}{\protect\end{center}}

\chapter{Affine geometry}\label{chap:trans}
\addtocontents{toc}{\protect\begin{quote}}

\section*{Affine transformations}
\addtocontents{toc}{Affine transformations.}

\emph{Affine geometry} studies the so called \index{incidence structure}\emph{incidence structure} of the Euclidean plane.
The incidence structure says which points lie on which lines and nothing else;
we cannot talk about distances, angle measures and so on.

In other words, affine geometry studies
the properties of the Euclidean plane which preserved under {}\emph{affine transformations} defined below.

A bijection of Euclidean plane to itself 
is called \index{affine transformation}\emph{affine transformation}
if it maps any line to a line.

We say that three points are \index{collinear}\emph{collinear} if they lie on one line. 
Note that affine transformation sends collinear points to collinear; the following exercise gives a converse.

\begin{thm}{Exercise}\label{ex:collinear=affine}
Assume $f$ is a bijection from Euclidean plane to itself which sends collinear points to collinear points.
Show that $f$ is an affine transformation.
(In other words, show that $f$ maps noncollinear points to noncollinear.)
\end{thm}

\begin{thm}{Exercise}\label{ex:affine-par}
Show that affine transformation sends a pair of parallel lines to a pair of parallel lines.
\end{thm}

\section*{Constructions}
\addtocontents{toc}{Constructions.}

Let us consider geometric constructions with a ruler and a \index{parallel tool}\emph{parallel tool};
the latter makes possible to draw a line thru a given point parallel to a given line.
By Exercisers~\ref{ex:affine-par}, any construction with these two tools are invariant with respect to affine transformation.
For example, 
to solve the following exercise,
it is sufficient to prove that midpoint of given segment can be constructed with a ruler and a parallel tool.

\begin{thm}{Exercise}\label{ex:midpoint-affine}
Let $M$ be the midpoint of segment $[AB]$ in the Euclidean plane.
Assume that an affine transformation sends the points $A$, $B$ and $M$
to $A'$, $B'$ and $M'$ correspondingly.
Show that $M'$ is the midpoint of~$[A'B']$.
\end{thm}

The following exercise will be used in the proof of Theorem~\ref{thm:affine=linear}.

\begin{thm}{Exercise}\label{ex:R-hom}
Assume that the points with the coordinates $(0,0)$, $(1,0)$, $(a,0)$ and $(b,0)$ are given.
Using a ruler and a parallel tool, construct the points with the coordinates $(a\cdot b,0)$ and $(a+b,0)$.
\end{thm}

\begin{thm}{Exercise}\label{ex:center-circ-affine}
Use ruler and parallel tool to construct the center of the given circle.
\end{thm}

\section*{Matrix form}
\addtocontents{toc}{Matrix form.}

Since the lines are defined in terms of metric;
any motion of Euclidean plane is also an affine transformation.

We will show that there are affine transformations of Euclidean plane which are not motions.

Fix a coordinate system on the Euclidean plane.
Let us use the column notation for the coordinates;
that is, we will write $\left(\begin{smallmatrix}
x\\y
\end{smallmatrix} \right)$ instead of $(x,y)$.

As it follows from the theorem below,
the so called {}\emph{shear mapping} $\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)\mapsto \left(\begin{smallmatrix}
x+k\cdot y\\ y
\end{smallmatrix} \right)$ is an affine transformation.
The shear mapping can change the angle between vertical and horizontal lines almost arbitrary.
The latter can be used to prove impossibility of some constructions with a ruler and a parallel tool;
here is one example.

\begin{thm}{Exercise}\label{ex:affine-perp}
Show that with a ruler and a parallel tool one cannot construct a line perpendicular to a given line.
\end{thm}

\begin{thm}{Theorem}\label{thm:affine=linear}
A map $\beta$ from the plane to itself
is an affine transformation if and only if 
\[\beta\:\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
  \mapsto
  \left(\begin{smallmatrix}
a&b\\ c&d
\end{smallmatrix} \right)
  \cdot
  \left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
  +
\left(\begin{smallmatrix}
v\\ w
\end{smallmatrix} \right)
=\left(\begin{smallmatrix}
a\cdot x+b\cdot y+v\\ 
c\cdot x+d\cdot y+w 
\end{smallmatrix} \right)
\eqlbl{eq:affine=linear}
\]
for a fixed invertible matrix $\bigl(\begin{smallmatrix}
a&b\\ c&d
\end{smallmatrix} \bigr)$ and a vector $\bigl(\begin{smallmatrix}
v\\ w
\end{smallmatrix} \bigr)$.

In particular, any affine transformation of Euclidean plane is continuous.
\end{thm}

In the proof of the ``only if'' part,
we will use the following algebraic lemma:

\begin{thm}{Algebraic lemma}\label{lem:R-auto}
Assume $f\:\mathbb{R}\to\mathbb{R}$ is a function such that for any $x,y\in\mathbb{R}$ we have
\begin{enumerate}[(a)]
\item\label{lem:R-auto:a} $f(1)=1$,
\item\label{lem:R-auto:b} $f(x+y)=f(x)+f(y)$,
\item\label{lem:R-auto:c} $f(x\cdot y)=f(x)\cdot f(y)$.
\end{enumerate}

Then $f$ is the identity function; that is,
$f(x)=x$ for any $x\in \mathbb{R}$.
\end{thm}

Note that we do not assume that $f$ is continuous.

The function $f$ satisfying these three conditions
is called \index{field automorphism}\emph{field automorphism}.
Therefore, the lemma states that the identity function is the only automorphism of the field of real numbers.
For the field of complex numbers, the conjugation $z\mapsto\bar z$ (see page \pageref{page:cojugation=authomorphism}) gives an example of nontrivial automorphism.

\parit{Proof.}
By \textit{(\ref{lem:R-auto:b})} we have
\[f(0)+f(1)=f(0+1).\]
By \textit{(\ref{lem:R-auto:a})}
\[f(0)+1=1;\]
whence
\[f(0)=0.
\eqlbl{eq:0=0}\]

Applying \textit{(\ref{lem:R-auto:b})} again, we get that
\[0=f(0)=f(x)+f(-x).\]
Therefore, 
\[f(-x)=-f(x)
\quad
\text{for any}
\quad
x\in \mathbb{R}.
\eqlbl{eq:f-x}\] 

Applying \textit{(\ref{lem:R-auto:b})} recurrently, we get that
\begin{align*}
f(2)&=f(1)+f(1)=1+1=2;\\
f(3)&=f(2)+f(1)=2+1=3;\\
&\dots
\end{align*}
Together with \ref{eq:f-x},
the latter implies that 
$$f(n)=n
\quad
\text{for any integer}
\quad
n.$$ 

By \textit{(\ref{lem:R-auto:c})}
\[f(m)=f(\tfrac mn)\cdot f(n).\]
Therefore
$$f(\tfrac mn)=\tfrac mn \eqlbl{eq:m/n}$$
for any rational number~$\tfrac mn$.

Assume~$a\ge 0$.
Then the equation $x\cdot x=a$ has a real solution $x\z=\sqrt{a}$.
Therefore, $[f(\sqrt{a})]^2=f(\sqrt{a})\cdot f(\sqrt{a})=f(a)$.
Hence $f(a)\ge 0$.
That is,
\[a\ge 0\quad\Longrightarrow\quad f(a)\ge 0.\eqlbl{a>0=>b>0}\]

Applying \ref{eq:f-x}, 
we also get 
\[a\le 0\quad \Longrightarrow\quad f(a)\le 0.\eqlbl{a<0=>b<0}\]

Finally, assume $f(a)\ne a$ for some $a\in\mathbb{R}$.
Then there is a rational number $\tfrac{m}{n}$ which lies between $a$ and $f(a)$;
that is, 
the numbers 
\[x\z=a-\tfrac{m}{n}\quad\text{and}\quad y=f(a)-\tfrac{m}{n}\]
have opposite signs.

By \ref{eq:m/n},
\begin{align*}
y+\tfrac{m}{n}&=f(a)=
\\
&=f(x+\tfrac{m}{n})=
\\
&=f(x)+f(\tfrac{m}{n})=
\\
&=f(x)+\tfrac{m}{n};
\intertext{that is,}
f(x)&=y
\end{align*}
By \ref{a>0=>b>0} and \ref{a<0=>b<0} the values $x$ and $y$ can not have opposite signs, a contradiction.
\qeds

\begin{thm}{Lemma}\label{lem:3-fix}
Assume $\gamma$ is an affine transformation which fix three points $\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right)$, 
$\left(\begin{smallmatrix}
1\\ 0
\end{smallmatrix} \right)$ 
and $\left(\begin{smallmatrix}
0\\ 1
\end{smallmatrix} \right)$ on the coordinate plane.
Then $\gamma$ is the identity map; 
that is, $\gamma\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
=
\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)$ for any point $\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)$.
\end{thm}

\parit{Proof.}
Since an affine transformation sends lines to lines, we get that each axes is mapped to itself.

According to Exercise~\ref{ex:affine-par}, 
parallel lines are mapped to parallel lines.
Therefore, we get that horizontal lines mapped to horizontal lines 
and
vertical lines mapped to vertical.
In other words,
\[\gamma\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
=
\left(\begin{smallmatrix}
f(x)\\ h(y)
\end{smallmatrix} \right).\]
for some functions $f,h\:\mathbb{R}\to\mathbb{R}$.

Note that $f(1)=h(1)=1$ and according to 
Exercise \ref{ex:R-hom}, 
both $f$ and $h$ satisfies the other two conditions of the algebraic lemma (\ref{lem:R-auto}).
Applying the lemma, we get that $f$ and $h$ 
are identity functions
and so is~$\gamma$.
\qeds

\parit{Proof of Theorem~\ref{thm:affine=linear}.}
Recall that matrix 
$\left(\begin{smallmatrix}
a&b\\ c&d
\end{smallmatrix} \right)$
is invertible if
$$\det\left(\begin{smallmatrix}
a&b\\ c&d
\end{smallmatrix} \right)
=a\cdot d-b\cdot c\ne 0;$$
in this case the matrix 
\[\tfrac{1}{a\cdot d-b\cdot c}
  \cdot\left(\begin{smallmatrix}
d&-b\\ -c&a
\end{smallmatrix} \right)\] 
is the inverse of 
$\left(\begin{smallmatrix}
a&b\\ c&d
\end{smallmatrix} \right)$.

Assume that the map $\beta$ is described by \ref{eq:affine=linear}.
Note that
\[\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
\mapsto
  \tfrac{1}{a\cdot d-b\cdot c}
  \cdot\left(\begin{smallmatrix}
d&-b\\ -c&a
\end{smallmatrix} \right)
\cdot
\left(\begin{smallmatrix}
x-v\\ y-w
\end{smallmatrix} \right).
\eqlbl{eq:beta-inv}
\] 
is inverse of~$\beta$.
In particular, $\beta$ is a bijection.

Any line in the plane is given by equation
\[p\cdot x+q\cdot y+r=0,\eqlbl{ax+by+c=0}\]
where $p\ne 0$ or $q\ne 0$.
Find $\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)$ from its $\beta$-image by formula \ref{eq:beta-inv} and substitute the result in \ref{ax+by+c=0}.
You will get the equation of the image of the line.
The equation has the same type as \ref{ax+by+c=0}, with different constants; 
in particular, it describes a line.

Therefore we proved that $\beta$ is an affine transformation.

To prove the ``only if'' part,
fix an affine transformation~$\alpha$.
Set 
\begin{align*}
\left(\begin{smallmatrix}
v\\ w
\end{smallmatrix} \right)
&= 
\alpha\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right),
\\
\left(\begin{smallmatrix}
a\\ c
\end{smallmatrix} \right)
&=
\alpha\left(\begin{smallmatrix}
1\\ 0
\end{smallmatrix} \right)
-
\alpha\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right),
\\
\left(\begin{smallmatrix}
b\\ d
\end{smallmatrix} \right)
&=
\alpha\left(\begin{smallmatrix}
1\\ 0
\end{smallmatrix} \right)
-
\alpha\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right).
\end{align*}


Note that the points 
$\alpha\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right)$, 
$\alpha\left(\begin{smallmatrix}
0\\ 1
\end{smallmatrix} \right)$, 
$\alpha\left(\begin{smallmatrix}
1\\ 0
\end{smallmatrix} \right)$ do not lie on one line. 
Therefore, the matrix $\bigl(\begin{smallmatrix}
a&b\\ c&d
\end{smallmatrix} \bigr)$
is invertible.

For the affine transformation $\beta$ defined by \ref{eq:affine=linear}
we have 
\begin{align*}
\beta\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right)
&=
\alpha\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right),
\\
\beta\left(\begin{smallmatrix}
1\\ 0
\end{smallmatrix} \right)
&=
\alpha\left(\begin{smallmatrix}
1\\ 0
\end{smallmatrix} \right),
\\
\beta\left(\begin{smallmatrix}
0\\ 1
\end{smallmatrix} \right)
&=
\alpha\left(\begin{smallmatrix}
0\\ 1
\end{smallmatrix} \right).
\end{align*}


It remains to show that $\alpha=\beta$ or equivalently the composition $\gamma\z=\alpha\circ \beta^{-1}$ is the identity map.

Note that $\gamma$ is an affine transformation which fix points $\left(\begin{smallmatrix}
0\\ 0
\end{smallmatrix} \right)$, 
$\left(\begin{smallmatrix}
1\\ 0
\end{smallmatrix} \right)$ 
and $\left(\begin{smallmatrix}
0\\ 1
\end{smallmatrix} \right)$.
It remains to apply Lemma~\ref{lem:3-fix}.
\qeds

\section*{On inversive transformations}
\addtocontents{toc}{On inversive transformations.}


Recall that inversive plane is Euclidean plane with added a point at infinity, denoted by~$\infty$.
We assume that every line passes thru~$\infty$.
Recall that the term {}\emph{circline} stays for {}\emph{circle or line};

An \index{inversive transformation}\emph{inversive transformation} is a bijection from inversive plane to itself which sends circlines to circlines.
\emph{Inversive geometry} studies the {}\emph{circline incidence structure} of inversive plane;
it says which points lie on which circlines.

\begin{thm}{Theorem}\label{thm:inversions-inversive}
A map from inversive plane to itself is an inversive transformation
if and only if it can be presented as a composition of inversions and reflections.  
\end{thm}

Exercise \ref{ex:inversion-Mob} gives another description of inversive transformations which use complex coordinates.

\parit{Proof.}
According to Theorem~\ref{thm:inverse-cline} any inversion is a inversive transformation.
Therefore, the same holds for composition of inversions and reflection.

To prove the converse, 
fix an inversive transformation~$\alpha$.

Assume $\alpha(\infty)=\infty$.
Recall that any circline passing thru $\infty$ is a line.
If follows that $\alpha$ maps lines to lines;
that is,
it is an affine transformation.

Note that $\alpha$ is not an arbitrary affine transformation --- it maps circles to circles.

Composing $\alpha$ with a reflection, say $\rho_1$, we can assume that $\alpha'\z=\rho_1\circ\alpha$ maps the unit circle with center at the origin to a concentric circle. 

Composing the obtained map $\alpha'$ with a {}\emph{homothety} 
\[\chi\:\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)\mapsto \left(\begin{smallmatrix}
k\cdot x\\ k\cdot y
\end{smallmatrix} \right),\]
we can assume that $\alpha''=\chi\circ\alpha'$ sends the unit circle to itself.


Composing the obtained map $\alpha''$ with a reflection $\rho_2$ in a line thru the origin,
we can assume that $\alpha'''=\rho_2\circ\alpha''$ maps the point $(1,0)$ to itself.

By Exercise~\ref{ex:center-circ-affine},
$\alpha'''$ fixes the center of the circle;
that is, it fixes the origin.

The obtained map $\alpha'''$ is an affine transformation.
Applying Theorem~\ref{thm:affine=linear}, together with the properties of $\alpha''$ described above we get that
\[\alpha'''\:\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
  \mapsto
  \left(\begin{smallmatrix}
1&b\\ 0&d
\end{smallmatrix} \right)
  \cdot
  \left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
\]
for an invertible matrix $\left(\begin{smallmatrix}
1&b\\ 0&d
\end{smallmatrix} \right)$.
Since the point $(0,1)$ maps to the unit circle we get that 
\[b^2+d^2=1.\]
Since the point $(\tfrac1{\sqrt{2}},\tfrac1{\sqrt{2}})$ maps to the unit circle we get that 
\[(b+d)^2=1.\]
It follows 
\[\alpha'''\:\left(\begin{smallmatrix}
x\\ y
\end{smallmatrix} \right)
  \mapsto
  \left(\begin{smallmatrix}
1&0\\ 0&\pm1
\end{smallmatrix} \right)
\cdot
\left(\begin{smallmatrix}
x
\\ 
y
\end{smallmatrix} \right);
\]
that is, either $\alpha'''$ is the identity map or reflection in the $x$-axis.

Note that the homothety $\chi$ is a composition of two inversions in concentric circles.
Therefore, $\alpha$ is a composition of inversions and reflections if and only are so is $\alpha'$, $\alpha''$ and $\alpha'''$.

In the remaining case $\alpha(\infty)\ne \infty$, set $P=\alpha(\infty)$.
Consider an inversion $\beta$ in a circle with center at~$P$.
Note that $\beta(P)=\infty$; 
therefore, $\beta\circ\alpha(\infty)=\infty$.
Since $\beta$ is inversive, so is $\beta\circ\alpha$.
From above we get that $\beta\circ\alpha$ is a composition of reflections and inversions;
therefore, so is~$\alpha$.
\qeds

\begin{thm}{Exercise}\label{ex:inversive-angle}
Show that inversive transformations preserve the angle between arcs up to sign.

More precisely, assume $A'B_1'C_1'$, $A'B_2'C_2'$ are the images of two arcs $AB_1C_1$, $AB_2C_2$ under an inversive transformation.
Let $\alpha$ and $\alpha'$ denote the angle between the tangent half-lines to $AB_1C_1$ and $AB_2C_2$ at $A$
and the angle between the tangent half-lines to $A'B_1'C_1'$ and $A'B_2'C_2'$ at $A'$ correspondingly.
Then 
\[\alpha'=\pm \alpha.\]
\end{thm}


\begin{thm}{Exercise}\label{ex:reflection/inversive}
Show that any reflection can be presented as a composition of three inversions. 
\end{thm}

Note that exercise above together with Theorem~\ref{thm:inversions-inversive},
implies that any inversive map is a composition of inversions,
no reflections are needed.

\addtocontents{toc}{\protect\end{quote}}
